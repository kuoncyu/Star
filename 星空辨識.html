<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—åŠçƒæ˜Ÿåº§åœ–é‘‘ (æ¯æ—¥ä¸€æ˜Ÿç‰ˆ)</title>
    <style>
        :root {
            /* æ˜Ÿç©ºè‰²ç³» */
            --primary: #5c6bc0;    /* é›è— */
            --secondary: #ab47bc;  /* ç´«è‰² */
            --accent: #ffd54f;     /* æ˜Ÿæ˜Ÿé‡‘ */
            --bg: #0f172a;         /* æ·±å¤œè—é»‘ */
            --card-bg: #1e293b;    /* å¡ç‰‡æ·±è— */
            --text: #e2e8f0;       /* äº®ç°ç™½ */
            --text-muted: #94a3b8; /* éœéŸ³ç° */
            
            /* ç‹€æ…‹æ¨™ç±¤é¡è‰² */
            --status-zodiac: #f59e0b;   /* é»ƒé“ï¼šé‡‘é»ƒ */
            --status-spring: #4ade80;   /* æ˜¥ï¼šå«©ç¶  */
            --status-summer: #f43f5e;   /* å¤ï¼šç†±æƒ…ç´… */
            --status-autumn: #fbbf24;   /* ç§‹ï¼šæ©™é»ƒ */
            --status-winter: #60a5fa;   /* å†¬ï¼šå†°è— */
            --status-polar: #a78bfa;    /* æ‹±æ¥µï¼šç´« */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: "Noto Sans TC", "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        /* --- Header --- */
        header {
            background: linear-gradient(135deg, #0f172a, #312e81);
            color: white;
            padding: 1.2rem 1rem;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            position: sticky; top: 0;
            z-index: 100;
            border-bottom: 1px solid #3730a3;
        }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1.5px; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .subtitle { font-size: 0.8rem; opacity: 0.8; margin-top: 5px; color: #c7d2fe; }

        /* --- Navigation --- */
        .nav {
            display: flex;
            justify-content: flex-start;
            gap: 10px; 
            padding: 10px 15px;
            background: #1e293b; 
            border-bottom: 1px solid #334155;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: sticky;
            top: 78px; z-index: 90;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .nav::-webkit-scrollbar { display: none; }
        
        .nav-btn {
            padding: 8px 18px;
            border: none; border-radius: 50px;
            background: #334155; color: #cbd5e1; cursor: pointer;
            font-weight: bold; transition: all 0.2s; 
            font-size: 0.9rem; white-space: nowrap;
            flex-shrink: 0;
        }
        .nav-btn.active {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 0 10px rgba(92, 107, 192, 0.5);
        }

        .container { 
            max-width: 1000px;
            margin: 0 auto; padding: 15px; 
            min-height: 80vh;
        }
        .section { display: none; animation: fadeIn 0.3s ease-out; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Daily Card --- */
        .daily-container { width: 100%; max-width: 480px; margin: 0 auto; text-align: center; }
        
        .card-scene {
            perspective: 1000px;
            width: 100%; 
            height: min(580px, 65vh);
            margin: 20px auto; 
            position: relative;
        }
        .card-inner {
            position: relative;
            width: 100%; height: 100%; text-align: center;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            transform-style: preserve-3d;
        }
        .card-inner.is-flipped { transform: rotateY(180deg); }
        
        .card-face {
            position: absolute;
            width: 100%; height: 100%;
            backface-visibility: hidden; 
            -webkit-backface-visibility: hidden;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            overflow: hidden;
            background: var(--card-bg);
            border: 1px solid #334155;
        }
        
        .card-front {
            background: linear-gradient(135deg, #0f172a, #2e1065);
            color: white; 
            border: 2px solid #6366f1;
            z-index: 2;
            cursor: pointer;
        }
        .card-back {
            transform: rotateY(180deg);
            padding: 0; justify-content: flex-start;
            background: #1e293b;
            z-index: 1;
        }
        
        /* é–ƒçˆæ˜Ÿæ˜ŸèƒŒæ™¯æ•ˆæœ */
        .stars-bg {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background-image: radial-gradient(white 1px, transparent 1px);
            background-size: 50px 50px; opacity: 0.2;
        }

        .daily-img-wrapper { 
            width: 100%;
            height: 55%; 
            background: #000; 
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: zoom-in;
        }
        .daily-img { 
            width: 100%;
            height: 100%; 
            object-fit: contain; 
            display: block;
        }
        .zoom-hint {
            position: absolute;
            bottom: 10px; right: 10px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(4px);
            color: white; padding: 6px 10px;
            border-radius: 20px; font-size: 0.75rem;
            pointer-events: none;
        }

        .daily-info-box { 
            padding: 20px;
            text-align: left; height: 45%; 
            overflow-y: auto; box-sizing: border-box; 
            -webkit-overflow-scrolling: touch;
        }
        .daily-date { 
            background: rgba(255,255,255,0.1);
            padding: 5px 15px; border-radius: 20px; 
            margin-bottom: 20px; font-size: 0.9rem; letter-spacing: 1px; color: var(--accent);
        }

        /* --- Tools & Grid --- */
        .tools-bar {
            background: #1e293b;
            padding: 15px; border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); margin-bottom: 20px;
            border: 1px solid #334155;
        }
        .search-box {
            width: 100%;
            padding: 12px; border: 1px solid #475569;
            background: #0f172a; color: white;
            border-radius: 8px; font-size: 1rem; box-sizing: border-box; margin-bottom: 12px;
            -webkit-appearance: none;
        }
        .search-box::placeholder { color: #64748b; }
        
        .filter-scroll { 
            display: flex;
            gap: 8px; overflow-x: auto; padding-bottom: 5px; 
            scrollbar-width: none; -webkit-overflow-scrolling: touch;
        }
        .filter-tag {
            white-space: nowrap;
            padding: 6px 14px; border-radius: 15px;
            background: #334155; border: 1px solid #475569; cursor: pointer; 
            font-size: 0.85rem; color: #cbd5e1; flex-shrink: 0;
            transition: 0.2s;
        }
        .filter-tag.active { 
            background: var(--primary); color: white; border-color: var(--primary); 
            box-shadow: 0 0 8px rgba(92, 107, 192, 0.4);
        }

        .plant-grid { 
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px; 
        }
        .plant-card {
            background: var(--card-bg);
            border-radius: 12px; padding: 15px 10px; text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); cursor: pointer; 
            border: 1px solid #334155;
            display: flex;
            flex-direction: column; justify-content: center; min-height: 110px;
            position: relative;
            transition: transform 0.2s;
        }
        @media (hover: hover) {
            .plant-card:hover { 
                transform: translateY(-5px);
                border-color: var(--secondary); 
                box-shadow: 0 0 15px rgba(171, 71, 188, 0.3); 
            }
        }
        .plant-card:active { transform: scale(0.98); background: #26354f; }

        .p-name { font-weight: bold; font-size: 1.1rem; color: #e2e8f0; margin-bottom: 5px; }
        .p-cat { font-size: 0.75rem; color: #94a3b8; margin-bottom: 8px; font-style: italic;}
        
        .status-badge {
            font-size: 0.7rem;
            color: white; padding: 3px 8px; border-radius: 4px;
            display: inline-block; font-weight: bold; margin-top: auto;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        .st-zodiac { background: var(--status-zodiac); color: #422006; }
        .st-spring { background: var(--status-spring); color: #064e3b; }
        .st-summer { background: var(--status-summer); }
        .st-autumn { background: var(--status-autumn); color: #451a03; }
        .st-winter { background: var(--status-winter); color: #0c4a6e; }
        .st-polar  { background: var(--status-polar); }

        /* --- Quiz --- */
        .quiz-panel {
            background: #1e293b;
            padding: 25px 20px; border-radius: 16px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); text-align: center;
            max-width: 600px; margin: 0 auto;
            border: 1px solid #334155;
        }
        .q-media-box {
            height: 280px;
            background: #0f172a; border: 2px dashed #475569;
            border-radius: 12px; margin: 20px 0; display: flex;
            align-items: center; justify-content: center; position: relative;
            overflow: hidden;
        }
        .full-img { max-width: 100%; max-height: 100%; object-fit: contain; display: none; }
        
        .opt-btn {
            width: 100%;
            padding: 14px; margin-bottom: 10px; background: #334155;
            border: 1px solid #475569; border-radius: 10px; font-size: 0.95rem;
            cursor: pointer; font-weight: bold; color: #e2e8f0;
            transition: 0.2s;
        }
        .opt-btn:active { background: #475569; }
        .opt-btn.correct { background: #065f46; border-color: #34d399; color: #fff; }
        .opt-btn.wrong { background: #7f1d1d; border-color: #f87171; color: #fff; }

        /* --- Modal --- */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000;
            display: none; justify-content: center; align-items: center; padding: 15px;
            backdrop-filter: blur(8px);
        }
        .modal-box {
            background: #1e293b;
            width: 100%; max-width: 500px;
            border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;
            max-height: 85vh; border: 1px solid #475569;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .img-area { 
            height: 40vh;
            background: #000; display: flex; align-items: center; justify-content: center; 
        }
        .info-area { padding: 20px; overflow-y: auto; color: #cbd5e1; }
        
        .loader {
            border: 3px solid #334155;
            border-top: 3px solid var(--accent);
            border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .reveal-box {
            background: #0f172a;
            border: 1px solid #334155; border-radius: 12px;
            padding: 15px; text-align: left; margin-top: 15px; display: none;
        }

        @media (min-width: 768px) {
            .container { padding: 30px; }
            .plant-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
            .nav { justify-content: center; top: 85px; }
            .card-scene { height: 550px; }
            h1 { font-size: 2rem; }
            .img-area { height: 300px; }
        }

    </style>
</head>
<body>

<header>
    <h1>ğŸŒŒ åŒ—åŠçƒæ˜Ÿåº§åœ–é‘‘</h1>
    <div class="subtitle">æ”¶éŒ„ 50+ å€‹å››å­£å¸¸è¦‹æ˜Ÿåº§èˆ‡ç¥è©±</div>
</header>

<div class="nav">
    <button class="nav-btn active" onclick="setTab('daily', this)">ğŸ”­ æ¯æ—¥ä¸€æ˜Ÿ</button>
    <button class="nav-btn" onclick="setTab('guide', this)">ğŸ“– æ˜Ÿåº§åˆ—è¡¨</button>
    <button class="nav-btn" onclick="setTab('quiz', this)">ğŸª å¤©æ–‡æ¸¬é©—</button>
</div>

<div class="container">

    <div id="sec-daily" class="section active">
        <div class="daily-container">
            <h2 style="color:var(--primary); margin: 0 0 5px 0; font-size: 1.3rem; color: #a5b4fc;">ğŸ“… ä»Šå¤©çš„è§€æ¸¬ç›®æ¨™</h2>
            <p style="color:#94a3b8; font-size:0.85rem; margin-top: 0;">ä»°æœ›æ˜Ÿç©ºï¼Œå°‹æ‰¾ä»Šæ™šçš„æŒ‡å¼•</p>
            
            <div class="card-scene">
                <div class="card-inner" id="daily-card-inner">
                    <div class="card-face card-front" onclick="flipDailyCard()">
                        <div class="stars-bg"></div>
                        <div style="font-size:4rem; margin-bottom:10px; text-shadow: 0 0 20px rgba(255,215,0,0.6);">âœ¨</div>
                        <h2 style="letter-spacing: 2px; font-size: 1.5rem;">DAILY STAR</h2>
                        <div class="daily-date" id="daily-date-display">...</div>
                        <p style="opacity: 0.8; font-size: 0.9rem; color: #c7d2fe;">é»æ“Šç¿»é–‹æ˜Ÿåœ–</p>
                    </div>
                    
                    <div class="card-face card-back">
                        <div class="daily-img-wrapper" onclick="openDailyZoom()">
                            <img id="daily-img" class="daily-img" src="" alt="Constellation">
                            <div class="loader" id="daily-loader" style="position:absolute; top:45%; left:45%;"></div>
                            <div class="zoom-hint">ğŸ” é»åœ–æ”¾å¤§</div>
                        </div>
                        <div class="daily-info-box">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <h2 id="daily-name" style="margin:0; color:var(--accent); font-size: 1.4rem;">è¼‰å…¥ä¸­...</h2>
                                <span id="daily-status" class="status-badge"></span>
                            </div>
                            <p id="daily-eng" style="color:#94a3b8; font-style:italic; font-size:0.85rem; margin-top:2px;"></p>
                            <hr style="border:0; border-top:1px solid #334155; margin:10px 0;">
                            <p id="daily-desc" style="line-height:1.6; color:#cbd5e1; font-size:0.9rem;">
                                é€£ç·šå®‡å®™è³‡æ–™åº«ä¸­...
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="sec-guide" class="section">
        <div class="tools-bar">
            <input type="text" id="search-input" class="search-box" placeholder="æœå°‹ (å¦‚ï¼šçµæˆ¶åº§, Leo)..." onkeyup="renderGuide()">
            <div class="filter-scroll">
                <div class="filter-tag active" onclick="setFilter('all', this)">å…¨éƒ¨</div>
                <div class="filter-tag" onclick="setFilter('zodiac', this)">é»ƒé“åäºŒå®®</div>
                <div class="filter-tag" onclick="setFilter('spring', this)">æ˜¥å­£æ˜Ÿåº§</div>
                <div class="filter-tag" onclick="setFilter('summer', this)">å¤å­£æ˜Ÿåº§</div>
                <div class="filter-tag" onclick="setFilter('autumn', this)">ç§‹å­£æ˜Ÿåº§</div>
                <div class="filter-tag" onclick="setFilter('winter', this)">å†¬å­£æ˜Ÿåº§</div>
                <div class="filter-tag" onclick="setFilter('polar', this)">åŒ—å¤©æ‹±æ¥µ</div>
            </div>
            <div style="text-align:right; font-size:0.75rem; color:#64748b; margin-top:8px;">
                æ”¶éŒ„æ•¸é‡ï¼š<span id="db-count">0</span> å€‹æ˜Ÿåº§
            </div>
        </div>
        <div id="guide-grid" class="plant-grid"></div>
    </div>

    <div id="sec-quiz" class="section">
        <div id="quiz-menu" class="quiz-panel">
            <h2 style="color:var(--accent); font-size: 1.4rem;">ğŸš€ å¤©æ–‡è¾¨è­˜æŒ‘æˆ°</h2>
            <p style="font-size: 0.95rem; color: #cbd5e1;">ä½ èƒ½èªå‡ºå¹¾å€‹å¤œç©ºä¸­çš„æ˜Ÿåº§ï¼Ÿ</p>
            <br>
            <div style="font-size:3.5rem; margin-bottom:15px;">ğŸŒ</div>
            <button class="nav-btn" style="background: linear-gradient(90deg, var(--primary), var(--secondary)); color:white; width:100%; padding:15px; font-size:1.1rem; box-shadow: 0 0 15px rgba(92, 107, 192, 0.4);" onclick="startQuiz()">
                é–‹å§‹è§€æ¸¬
            </button>
        </div>

        <div id="quiz-play" class="quiz-panel" style="display:none;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold; color:#94a3b8; font-size: 0.9rem;">
                <span id="q-progress">1 / 10</span>
                <span>åˆ†æ•¸: <span id="q-score">0</span></span>
            </div>
            
            <h3 style="margin:0; color:#e2e8f0; font-size: 1.2rem;">é€™æ˜¯å“ªä¸€å€‹æ˜Ÿåº§ï¼Ÿ</h3>
            <div id="skip-indicator" class="skip-msg" style="color:#f87171; font-size:0.8rem; display:none;">âš ï¸ åœ–ç‰‡è®€å–å¤±æ•—ï¼Œè‡ªå‹•è£œé¡Œ</div>

            <div class="q-media-box">
                <div class="loader" id="v-loader"></div>
                <img id="q-img" class="full-img">
            </div>

            <div id="opt-container"></div>
            <div id="feedback" style="height:25px; font-weight:bold; margin-top:5px; font-size: 1rem;"></div>

            <div id="reveal-card" class="reveal-box">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong id="rev-name" style="font-size:1.2rem; color:var(--accent);"></strong>
                    <span id="rev-status" class="status-badge"></span>
                </div>
                <p id="rev-desc" style="font-size:0.9rem; margin-top:8px; color:#cbd5e1; line-height:1.5;"></p>
                <a id="rev-link" href="#" target="_blank" style="font-size:0.85rem; display:block; margin-top:10px; color:var(--secondary); font-weight:bold;">ğŸ“– æŸ¥çœ‹ç¶­åŸºç™¾ç§‘</a>
            </div>

            <button id="next-btn" class="nav-btn" style="width:100%; background:var(--primary); color:white; margin-top:15px; display:none;" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â†’</button>
            <button onclick="quitQuiz()" style="background:none; border:none; margin-top:15px; color:#64748b; text-decoration:underline; cursor:pointer; font-size: 0.9rem;">é€€å‡ºæŒ‘æˆ°</button>
        </div>

        <div id="quiz-result" class="quiz-panel" style="display:none;">
            <h2>ğŸ† è§€æ¸¬çµæŸ</h2>
            <p>æœ¬æ¬¡å¾—åˆ†</p>
            <h1 id="final-score" style="font-size:3.5rem; margin:10px 0; color:var(--accent); text-shadow: 0 0 10px rgba(255,215,79,0.5);">0</h1>
            <div id="final-rank" style="font-size:1rem; background:#334155; color:white; padding:6px 20px; border-radius:20px; display:inline-block; font-weight:bold;"></div>
            <br><br>
            <button class="nav-btn" onclick="quitQuiz()">è¿”å›ä¸»é¸å–®</button>
        </div>
    </div>

</div>

<div id="modal" class="modal" onclick="closeModal(event)">
    <div class="modal-box">
        <div class="img-area">
            <div class="loader" id="m-loader"></div>
            <img id="m-img" class="full-img">
            <div id="m-err" style="display:none; color:#cbd5e1;">ç„¡åœ–ç‰‡è³‡æ–™</div>
        </div>
        <div class="info-area">
            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                <h2 id="m-name" style="margin:0; color:var(--accent); font-size: 1.5rem;"></h2>
                <span id="m-status" class="status-badge" style="margin:0;"></span>
            </div>
            <div id="m-latin" style="color:#94a3b8; font-style:italic; margin-bottom:10px; margin-top:2px; font-size: 0.9rem;"></div>
            <p id="m-desc" style="line-height:1.6; color:#cbd5e1; font-size: 0.95rem;">è®€å–ä¸­...</p>
            
            <a id="m-wiki" href="#" target="_blank" style="display:block; text-align:center; margin-top:20px; padding:12px; background:#334155; color:var(--accent); text-decoration:none; border-radius:8px; font-weight:bold;">å‰å¾€ç¶­åŸºç™¾ç§‘é–±è®€æ›´å¤š</a>
        </div>
        <button onclick="closeModal(null)" style="width:100%; padding:15px; border:none; background:#0f172a; color:#94a3b8; cursor:pointer; font-size:1rem; border-top:1px solid #334155; font-weight: bold;">é—œé–‰è¦–çª—</button>
    </div>
</div>

<script>
    // --- åŒ—åŠçƒå¸¸è¦‹æ˜Ÿåº§è³‡æ–™åº« ---
    // cat: zodiac(é»ƒé“), spring, summer, autumn, winter, polar(æ‹±æ¥µ)
    const constellations = [
        // --- é»ƒé“åäºŒå®® (Zodiac) ---
        { name: "ç™½ç¾Šåº§", eng: "Aries", cat: "zodiac", status: "é»ƒé“/ç«è±¡" },
        { name: "é‡‘ç‰›åº§", eng: "Taurus", cat: "zodiac", status: "é»ƒé“/ç•¢å®¿äº”" },
        { name: "é›™å­åº§", eng: "Gemini", cat: "zodiac", status: "é»ƒé“/åŒ—æ²³ä¸‰" },
        { name: "å·¨èŸ¹åº§", eng: "Cancer", cat: "zodiac", status: "é»ƒé“/æ˜Ÿåœ˜" },
        { name: "ç…å­åº§", eng: "Leo", cat: "zodiac", status: "é»ƒé“/è»’è½…åå››" },
        { name: "å®¤å¥³åº§", eng: "Virgo", cat: "zodiac", status: "é»ƒé“/è§’å®¿ä¸€" },
        { name: "å¤©ç§¤åº§", eng: "Libra", cat: "zodiac", status: "é»ƒé“/å¹³è¡¡" },
        { name: "å¤©è åº§", eng: "Scorpius", cat: "zodiac", status: "é»ƒé“/å¿ƒå®¿äºŒ" },
        { name: "äººé¦¬åº§", eng: "Sagittarius", cat: "zodiac", status: "é»ƒé“/éŠ€æ²³ä¸­å¿ƒ", wikiTerm: "äººé¦¬åº§" }, // å°„æ‰‹åº§
        { name: "æ‘©ç¾¯åº§", eng: "Capricornus", cat: "zodiac", status: "é»ƒé“/åŠç¾Šé­š" },
        { name: "å¯¶ç“¶åº§", eng: "Aquarius", cat: "zodiac", status: "é»ƒé“/æ°´ç“¶" },
        { name: "é›™é­šåº§", eng: "Pisces", cat: "zodiac", status: "é»ƒé“/å…©æ¢é­š" },

        // --- å†¬å­£æ˜Ÿåº§ (Winter) ---
        { name: "çµæˆ¶åº§", eng: "Orion", cat: "winter", status: "å†¬å­£/è…°å¸¶ä¸‰æ˜Ÿ" },
        { name: "å¤§çŠ¬åº§", eng: "Canis Major", cat: "winter", status: "å†¬å­£/å¤©ç‹¼æ˜Ÿ" },
        { name: "å°çŠ¬åº§", eng: "Canis Minor", cat: "winter", status: "å†¬å­£/å—æ²³ä¸‰" },
        { name: "å¾¡å¤«åº§", eng: "Auriga", cat: "winter", status: "å†¬å­£/äº”è»ŠäºŒ" },
        { name: "éº’éºŸåº§", eng: "Monoceros", cat: "winter", status: "å†¬å­£/é»¯æ·¡" },
        { name: "å¤©å…”åº§", eng: "Lepus", cat: "winter", status: "å†¬å­£/çµæˆ¶è…³ä¸‹" },
        { name: "æ³¢æ±Ÿåº§", eng: "Eridanus", cat: "winter", status: "å†¬å­£/æ²³æµ" },

        // --- æ˜¥å­£æ˜Ÿåº§ (Spring) ---
        { name: "ç‰§å¤«åº§", eng: "BoÃ¶tes", cat: "spring", status: "æ˜¥å­£/å¤§è§’æ˜Ÿ" },
        { name: "åŒ—å†•åº§", eng: "Corona Borealis", cat: "spring", status: "æ˜¥å­£/çš‡å† " },
        { name: "çµçŠ¬åº§", eng: "Canes Venatici", cat: "spring", status: "æ˜¥å­£/M51" },
        { name: "çƒé´‰åº§", eng: "Corvus", cat: "spring", status: "æ˜¥å­£/å››é‚Šå½¢" },
        { name: "å·¨çˆµåº§", eng: "Crater", cat: "spring", status: "æ˜¥å­£/è–æ¯" },
        { name: "é•·è›‡åº§", eng: "Hydra", cat: "spring", status: "æ˜¥å­£/æœ€é•·æ˜Ÿåº§" },
        { name: "åé«®åº§", eng: "Coma Berenices", cat: "spring", status: "æ˜¥å­£/æ˜Ÿåœ˜" },

        // --- å¤å­£æ˜Ÿåº§ (Summer) ---
        { name: "å¤©ç´åº§", eng: "Lyra", cat: "summer", status: "å¤å­£/ç¹”å¥³æ˜Ÿ" },
        { name: "å¤©é·¹åº§", eng: "Aquila", cat: "summer", status: "å¤å­£/ç‰›éƒæ˜Ÿ" },
        { name: "å¤©éµåº§", eng: "Cygnus", cat: "summer", status: "å¤å­£/å¤©æ´¥å››" },
        { name: "æµ·è±šåº§", eng: "Delphinus", cat: "summer", status: "å¤å­£/å¯æ„›" },
        { name: "æ­¦ä»™åº§", eng: "Hercules", cat: "summer", status: "å¤å­£/çƒç‹€æ˜Ÿåœ˜" },
        { name: "è›‡å¤«åº§", eng: "Ophiuchus", cat: "summer", status: "å¤å­£/ç¬¬åä¸‰å®®" },
        { name: "å·¨è›‡åº§", eng: "Serpens", cat: "summer", status: "å¤å­£/å”¯ä¸€åˆ†é–‹" },
        { name: "å¤©ç®­åº§", eng: "Sagitta", cat: "summer", status: "å¤å­£/å°å·§" },
        { name: "ç‹ç‹¸åº§", eng: "Vulpecula", cat: "summer", status: "å¤å­£/å•éˆ´æ˜Ÿé›²" },

        // --- ç§‹å­£æ˜Ÿåº§ (Autumn) ---
        { name: "é£›é¦¬åº§", eng: "Pegasus", cat: "autumn", status: "ç§‹å­£/å››é‚Šå½¢" },
        { name: "ä»™å¥³åº§", eng: "Andromeda", cat: "autumn", status: "ç§‹å­£/å¤§æ˜Ÿç³»" },
        { name: "è‹±ä»™åº§", eng: "Perseus", cat: "autumn", status: "ç§‹å­£/æµæ˜Ÿé›¨" },
        { name: "é¯¨é­šåº§", eng: "Cetus", cat: "autumn", status: "ç§‹å­£/æµ·æ€ª" },
        { name: "å—é­šåº§", eng: "Piscis Austrinus", cat: "autumn", status: "ç§‹å­£/åŒ—è½å¸«é–€" },
        { name: "ä¸‰è§’åº§", eng: "Triangulum", cat: "autumn", status: "ç§‹å­£/é¢¨è»Šæ˜Ÿç³»" },
        { name: "ç™½ç¾Šåº§", eng: "Aries", cat: "autumn", status: "ç§‹å­£/å…¬ç¾Š" }, // é‡è¤‡æ¨™è¨˜æ–¹ä¾¿æœå°‹
        { name: "é›™é­šåº§", eng: "Pisces", cat: "autumn", status: "ç§‹å­£/Vå­—å½¢" }, // é‡è¤‡æ¨™è¨˜

        // --- åŒ—å¤©æ‹±æ¥µ/å…¶ä»– (Polar/Other) ---
        { name: "å¤§ç†Šåº§", eng: "Ursa Major", cat: "polar", status: "æ‹±æ¥µ/åŒ—æ–—ä¸ƒæ˜Ÿ" },
        { name: "å°ç†Šåº§", eng: "Ursa Minor", cat: "polar", status: "æ‹±æ¥µ/åŒ—æ¥µæ˜Ÿ" },
        { name: "ä»™ååº§", eng: "Cassiopeia", cat: "polar", status: "æ‹±æ¥µ/Wå½¢" },
        { name: "ä»™ç‹åº§", eng: "Cepheus", cat: "polar", status: "æ‹±æ¥µ/åœ‹ç‹" },
        { name: "å¤©é¾åº§", eng: "Draco", cat: "polar", status: "æ‹±æ¥µ/ç›¤ç¹" },
        { name: "é¹¿è±¹åº§", eng: "Camelopardalis", cat: "polar", status: "æ‹±æ¥µ/é»¯æ·¡" },
        { name: "å¤©è²“åº§", eng: "Lynx", cat: "polar", status: "æ˜¥å­£/æš—æ·¡" }
    ];

    // --- Helper Functions ---
    function getStatusClass(status) {
        if (status.includes("é»ƒé“")) return "st-zodiac";
        if (status.includes("æ˜¥å­£")) return "st-spring";
        if (status.includes("å¤å­£")) return "st-summer";
        if (status.includes("ç§‹å­£")) return "st-autumn";
        if (status.includes("å†¬å­£")) return "st-winter";
        if (status.includes("æ‹±æ¥µ") || status.includes("åŒ—æ–—") || status.includes("åŒ—æ¥µ")) return "st-polar";
        return "st-polar"; // Default fallback
    }

    const getWikiData = async (name, wikiTerm = null) => {
        try {
            const term = wikiTerm || name;
            const res = await fetch(`https://zh.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(term)}`);
            if(!res.ok) throw new Error();
            return await res.json();
        } catch(e) { return null; }
    };

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        renderGuide();
        document.getElementById('db-count').innerText = constellations.length;
        
        // æ¯æ—¥ä¸€æ˜Ÿæ—¥æœŸ
        const today = new Date();
        const dateStr = `${today.getFullYear()} . ${today.getMonth()+1} . ${today.getDate()}`;
        document.getElementById('daily-date-display').innerText = dateStr;
    });

    // --- Tab Switching ---
    function setTab(tab, btn) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        
        document.getElementById(`sec-${tab}`).classList.add('active');
        btn.classList.add('active');
        window.scrollTo(0, 0);

        if (tab !== 'quiz') quitQuiz();
    }

    // --- Guide ---
    let currentFilter = 'all';
    function renderGuide() {
        const grid = document.getElementById('guide-grid');
        grid.innerHTML = '';
        const term = document.getElementById('search-input').value.toLowerCase();
        
        const list = constellations.filter(p => {
            let matchCat = false;
            if(currentFilter === 'all') matchCat = true;
            else if(currentFilter === 'zodiac') matchCat = p.cat === 'zodiac';
            else if(currentFilter === 'spring') matchCat = p.cat === 'spring' || p.status.includes('æ˜¥å­£');
            else if(currentFilter === 'summer') matchCat = p.cat === 'summer' || p.status.includes('å¤å­£');
            else if(currentFilter === 'autumn') matchCat = p.cat === 'autumn' || p.status.includes('ç§‹å­£');
            else if(currentFilter === 'winter') matchCat = p.cat === 'winter' || p.status.includes('å†¬å­£');
            else if(currentFilter === 'polar') matchCat = p.cat === 'polar' || p.status.includes('æ‹±æ¥µ');
            else matchCat = p.cat.includes(currentFilter);
            
            const matchSearch = p.name.includes(term) || p.eng.toLowerCase().includes(term);
            return matchCat && matchSearch;
        });

        // ç§»é™¤é‡è¤‡é¡¯ç¤º (å› ç‚ºæœ‰äº›æ˜Ÿåº§åŒæ™‚æ¨™è¨˜äº†å­£ç¯€å’Œé¡åˆ¥)
        const uniqueList = [...new Map(list.map(item => [item.name, item])).values()];

        uniqueList.forEach(p => {
            const el = document.createElement('div');
            el.className = 'plant-card';
            el.innerHTML = `
                <div class="p-name">${p.name}</div>
                <div class="p-cat">${p.eng}</div>
                <div class="status-badge ${getStatusClass(p.status)}">${p.status.split('/')[0]}</div>
            `;
            el.onclick = () => openModal(p);
            grid.appendChild(el);
        });
    }

    function setFilter(cat, btn) {
        currentFilter = cat;
        document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        renderGuide();
    }

    // --- Daily Card Logic ---
    let isDailyFlipped = false;
    let currentDailyItem = null;

    function flipDailyCard() {
        if (isDailyFlipped) return;
        
        const cardInner = document.getElementById('daily-card-inner');
        cardInner.classList.add('is-flipped');
        isDailyFlipped = true;
        
        loadDailyItemData();
    }
    
    function openDailyZoom() {
        if (!currentDailyItem) return;
        openModal(currentDailyItem);
    }

    async function loadDailyItemData() {
        const todayStr = new Date().toDateString();
        let hash = 0;
        for (let i = 0; i < todayStr.length; i++) hash = todayStr.charCodeAt(i) + ((hash << 5) - hash);
        const seed = Math.abs(hash); 
        const index = seed % constellations.length;
        const item = constellations[index];
        currentDailyItem = item;

        document.getElementById('daily-name').innerText = item.name;
        document.getElementById('daily-eng').innerText = item.eng;
        
        const badge = document.getElementById('daily-status');
        badge.innerText = item.status;
        badge.className = `status-badge ${getStatusClass(item.status)}`;

        const data = await getWikiData(item.name, item.wikiTerm);
        const img = document.getElementById('daily-img');
        const loader = document.getElementById('daily-loader');
        const desc = document.getElementById('daily-desc');

        if(data) {
            desc.innerText = data.extract ? (data.extract.substring(0, 100) + "...") : "æš«ç„¡è©³ç´°ä»‹ç´¹ã€‚";
            const src = data.originalimage ? data.originalimage.source : (data.thumbnail ? data.thumbnail.source : null);
            if(src) {
                img.src = src;
                img.onload = () => { loader.style.display = 'none'; };
            } else {
                loader.style.display = 'none';
                img.alt = "No Image Available";
                img.src = "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Celestia.png/640px-Celestia.png"; // Fallback space image
            }
        } else {
            loader.style.display = 'none';
            desc.innerText = "è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚";
        }
    }


    // --- Modal ---
    async function openModal(item) {
        const modal = document.getElementById('modal');
        const img = document.getElementById('m-img');
        const loader = document.getElementById('m-loader');
        
        modal.style.display = 'flex';
        img.style.display = 'none';
        loader.style.display = 'block';
        document.getElementById('m-err').style.display = 'none';
        document.getElementById('m-name').innerText = item.name;
        document.getElementById('m-latin').innerText = item.eng;
        document.getElementById('m-desc').innerText = "é€£ç·šç™¾ç§‘ä¸­...";
        document.getElementById('m-wiki').href = `https://zh.wikipedia.org/wiki/${item.wikiTerm || item.name}`;
        
        const badge = document.getElementById('m-status');
        badge.innerText = item.status;
        badge.className = `status-badge ${getStatusClass(item.status)}`;

        const data = await getWikiData(item.name, item.wikiTerm);
        if(data) {
            document.getElementById('m-desc').innerText = data.extract || "ç„¡è©³ç´°æ‘˜è¦";
            const src = data.originalimage ? data.originalimage.source : (data.thumbnail ? data.thumbnail.source : null);
            if(src) {
                img.src = src;
                img.onload = () => { loader.style.display='none'; img.style.display='block'; };
            } else {
                loader.style.display='none';
                document.getElementById('m-err').style.display='block';
            }
        } else {
            loader.style.display='none';
            document.getElementById('m-desc').innerText = "è³‡æ–™è®€å–å¤±æ•—ã€‚";
        }
    }

    function closeModal(e) {
        if(!e || e.target.id === 'modal') {
            document.getElementById('modal').style.display = 'none';
        }
    }

    // --- Quiz ---
    let gameState = { pool: [], queue: [], idx: 0, score: 0, answering: false };
    let retryCount = 0;

    function startQuiz() {
        // Remove duplicates for quiz
        const uniquePool = [...new Map(constellations.map(item => [item.name, item])).values()];
        let pool = [...uniquePool].sort(() => Math.random() - 0.5);
        gameState = { pool: pool, queue: pool.slice(0, 10), idx: 0, score: 0, answering: false };
        retryCount = 0;
        document.getElementById('quiz-menu').style.display = 'none';
        document.getElementById('quiz-result').style.display = 'none';
        document.getElementById('quiz-play').style.display = 'block';
        document.getElementById('q-score').innerText = 0;
        loadQuestion();
    }

    async function loadQuestion() {
        if(gameState.idx >= 10) { finishQuiz(); return; }
        
        const item = gameState.queue[gameState.idx];
        gameState.answering = true;

        document.getElementById('q-progress').innerText = `${gameState.idx+1} / 10`;
        document.getElementById('reveal-card').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback').innerText = '';
        document.getElementById('skip-indicator').style.display = 'none';
        document.getElementById('q-img').style.display = 'none';
        document.getElementById('v-loader').style.display = 'block';

        const data = await getWikiData(item.name, item.wikiTerm);
        const src = data && (data.originalimage ? data.originalimage.source : (data.thumbnail ? data.thumbnail.source : null));
        
        // å¦‚æœè©²è©æ¢æ²’æœ‰åœ–ç‰‡ (æ˜Ÿåº§æœ‰æ™‚æœƒé€™æ¨£)ï¼Œå‰‡è·³é
        if(!src || src.includes('icon') || src.includes('Symbol')) {
            handleSkip();
            return;
        }

        const img = document.getElementById('q-img');
        img.src = src;
        img.onload = () => {
            document.getElementById('v-loader').style.display = 'none';
            img.style.display = 'block';
            retryCount = 0;
        };
        img.onerror = () => { handleSkip(); }

        let opts = [item];
        const uniquePool = [...new Map(constellations.map(p => [p.name, p])).values()];
        let pool = uniquePool.filter(p => p.name !== item.name);
        
        for(let i=0; i<3; i++) opts.push(pool.splice(Math.floor(Math.random() * pool.length), 1)[0]);
        opts.sort(() => Math.random() - 0.5);
        document.getElementById('opt-container').innerHTML = opts.map(p => 
            `<button class="opt-btn" onclick="checkAnswer(this, '${p.name}')">${p.name}</button>`
        ).join('');
    }

    function handleSkip() {
        retryCount++;
        if(retryCount > 10) {
            alert("ç›®å‰ç¶²è·¯é€£ç·šç„¡æ³•å–å¾—è¶³å¤ åœ–ç‰‡ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
            quitQuiz();
            return;
        }
        let replacementIndex = 10 + retryCount;
        if(replacementIndex < gameState.pool.length) {
            gameState.queue[gameState.idx] = gameState.pool[replacementIndex];
            document.getElementById('skip-indicator').style.display = 'block';
            loadQuestion();
        } else {
            finishQuiz();
        }
    }

    function checkAnswer(btn, name) {
        if(!gameState.answering) return;
        gameState.answering = false;
        
        const correct = gameState.queue[gameState.idx];
        const isRight = name === correct.name;
        if(isRight) {
            btn.classList.add('correct');
            document.getElementById('feedback').innerText = "â­• è§€æ¸¬æ­£ç¢ºï¼";
            document.getElementById('feedback').style.color = "#4ade80";
            gameState.score += 10;
        } else {
            btn.classList.add('wrong');
            document.getElementById('feedback').innerText = `âŒ ç­”æ¡ˆæ˜¯ï¼š${correct.name}`;
            document.getElementById('feedback').style.color = "#f87171";
            document.querySelectorAll('.opt-btn').forEach(b => {
                if(b.innerText === correct.name) b.classList.add('correct');
            });
        }
        document.getElementById('q-score').innerText = gameState.score;
        document.getElementById('next-btn').style.display = 'block';

        const rev = document.getElementById('reveal-card');
        rev.style.display = 'block';
        document.getElementById('rev-name').innerText = correct.name;
        document.getElementById('rev-link').href = `https://zh.wikipedia.org/wiki/${correct.wikiTerm || correct.name}`;
        
        const badge = document.getElementById('rev-status');
        badge.innerText = correct.status;
        badge.className = `status-badge ${getStatusClass(correct.status)}`;

        getWikiData(correct.name, correct.wikiTerm).then(d => document.getElementById('rev-desc').innerText = d ? d.extract : "ç„¡è³‡æ–™");
    }

    function nextQuestion() {
        gameState.idx++;
        loadQuestion();
    }

    function finishQuiz() {
        document.getElementById('quiz-play').style.display = 'none';
        document.getElementById('quiz-result').style.display = 'block';
        document.getElementById('final-score').innerText = gameState.score;
        
        let rank = "";
        if(gameState.score === 100) rank = "ğŸŒŒ æ˜Ÿéš›é ˜èˆªå“¡";
        else if(gameState.score >= 80) rank = "ğŸ”­ å¤©æ–‡æ„›å¥½è€…";
        else if(gameState.score >= 60) rank = "âœ¨ è§€æ˜Ÿæ–°æ‰‹";
        else rank = "ğŸŒ‘ è¿·é€”çš„å¤ªç©ºäºº";
        document.getElementById('final-rank').innerText = rank;
    }

    function quitQuiz() {
        document.getElementById('quiz-play').style.display = 'none';
        document.getElementById('quiz-result').style.display = 'none';
        document.getElementById('quiz-menu').style.display = 'block';
    }
</script>

</body>
</html>